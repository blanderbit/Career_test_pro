<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js"></script>
</head>

<body>

<div style="width: 50%">
    <canvas id="canvas"></canvas>
</div>

<button id="convert">convert</button>

<script>
    document.getElementById('convert').addEventListener("click", function() {

        // only jpeg is supported by jsPDF
        var imgData = canvas.toDataURL("image/jpeg", 1.0);
        var pdf = new jsPDF();

        pdf.addImage(imgData, 'JPEG', 0, 0);
        pdf.save("download.pdf");
    }, false);
</script>

<script>
    var backgroundColor = 'white';
    Chart.plugins.register({
        beforeDraw: function(c) {
            var ctx = c.chart.ctx;
            ctx.fillStyle = backgroundColor;
            ctx.fillRect(0, 0, c.chart.width, c.chart.height);
        }
    });
    var chartColors = {
        red: 'rgb(255, 99, 132)',
        orange: 'rgb(255, 159, 64)',
        yellow: 'rgb(255, 205, 86)',
        green: 'rgb(75, 192, 192)',
        blue: 'rgb(54, 162, 235)',
        purple: 'rgb(153, 102, 255)',
        grey: 'rgb(231,233,237)'
    };

    var randomScalingFactor = function() {
        return (Math.random() > 0.5 ? 1.0 : 1.0) * Math.round(Math.random() * 100);
    };

    // draws a rectangle with a rounded top
    Chart.helpers.drawRoundedTopRectangle = function(ctx, x, y, width, height, radius) {
        ctx.beginPath();
        ctx.moveTo(x + radius, y);
        // top right corner
        ctx.lineTo(x + width - radius, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
        // bottom right	corner
        ctx.lineTo(x + width, y + height);
        // bottom left corner
        ctx.lineTo(x, y + height);
        // top left
        ctx.lineTo(x, y + radius);
        ctx.quadraticCurveTo(x, y, x + radius, y);
        ctx.closePath();
    };

    Chart.elements.RoundedTopRectangle = Chart.elements.Rectangle.extend({
        draw: function() {
            var ctx = this._chart.ctx;
            var vm = this._view;
            var left, right, top, bottom, signX, signY, borderSkipped;
            var borderWidth = vm.borderWidth;

            if (!vm.horizontal) {
                // bar
                left = vm.x - vm.width / 2;
                right = vm.x + vm.width / 2;
                top = vm.y;
                bottom = vm.base;
                signX = 1;
                signY = bottom > top? 1: -1;
                borderSkipped = vm.borderSkipped || 'bottom';
            } else {
                // horizontal bar
                left = vm.base;
                right = vm.x;
                top = vm.y - vm.height / 2;
                bottom = vm.y + vm.height / 2;
                signX = right > left? 1: -1;
                signY = 1;
                borderSkipped = vm.borderSkipped || 'left';
            }

            // Canvas doesn't allow us to stroke inside the width so we can
            // adjust the sizes to fit if we're setting a stroke on the line
            if (borderWidth) {
                // borderWidth shold be less than bar width and bar height.
                var barSize = Math.min(Math.abs(left - right), Math.abs(top - bottom));
                borderWidth = borderWidth > barSize? barSize: borderWidth;
                var halfStroke = borderWidth / 2;
                // Adjust borderWidth when bar top position is near vm.base(zero).
                var borderLeft = left + (borderSkipped !== 'left'? halfStroke * signX: 0);
                var borderRight = right + (borderSkipped !== 'right'? -halfStroke * signX: 0);
                var borderTop = top + (borderSkipped !== 'top'? halfStroke * signY: 0);
                var borderBottom = bottom + (borderSkipped !== 'bottom'? -halfStroke * signY: 0);
                // not become a vertical line?
                if (borderLeft !== borderRight) {
                    top = borderTop;
                    bottom = borderBottom;
                }
                // not become a horizontal line?
                if (borderTop !== borderBottom) {
                    left = borderLeft;
                    right = borderRight;
                }
            }

            // calculate the bar width and roundess
            var barWidth = 30;//Math.abs(left - right)
            var roundness = this._chart.config.options.barRoundness || 0.5;
            var radius = barWidth * roundness * 1;

            // keep track of the original top of the bar
            var prevTop = top;

            // move the top down so there is room to draw the rounded top
            top = prevTop + radius;

            var barRadius = top - prevTop;

            ctx.beginPath();
            ctx.fillStyle = vm.backgroundColor;
            ctx.strokeStyle = vm.borderColor;
            ctx.lineWidth = borderWidth;

            // draw the rounded top rectangle
            Chart.helpers.drawRoundedTopRectangle(ctx, left, (top - barRadius + 1), barWidth, bottom - prevTop, barRadius);

            ctx.fill();console.log(ctx)
            if (borderWidth) {
                ctx.stroke();
            }

            // restore the original top value so tooltips and scales still work
            top = prevTop;
        },
    });

    Chart.defaults.roundedBar = Chart.helpers.clone(Chart.defaults.bar);

    Chart.controllers.roundedBar = Chart.controllers.bar.extend({
        dataElementType: Chart.elements.RoundedTopRectangle
    });





    // var myBar = new Chart(ctx, {
    //     showTooltips: false,
    //     type: 'roundedBar',
    //     data: {
    //         labels: ["R", "I", "A", "S", "E", "C"],
    //         datasets: [{
    //             // label: 'Students',
    //             backgroundColor: [
    //                 '#F59A9A', '#4876D0', '#77DCC1', '#85B1F5', '#FDC572', '#F9892E'
    //             ],
    //             // borderWidth:[25, 25,
    //             //     25, 25 ,25, 25],
    //             data: [
    //                 100,90,80,80,90, 50, 0,
    //                 // randomScalingFactor(),
    //                 // randomScalingFactor(),
    //             ],
    //             radius: 12,
    //             dWidth: [12,4,5,6,8,9],
    //         }]
    //     },
    //     options: {
    //         responsive: true,
    //         barRoundness: 1,
    //         layout: {
    //             padding: {
    //                 left: 0,
    //                 right: 0,
    //                 top: 0,
    //                 bottom: 0
    //             }
    //         },
    //         legend: {
    //             display: false,
    //             labels: {
    //                 fontColor: 'rgb(255, 99, 132)'
    //             }
    //         },
    //         scales: {
    //             yAxes: [{
    //                 ticks: {
    //                     beginAtZero:true
    //                 }
    //             }]
    //         }
    //     },
    // });
    var ctx = document.getElementById("canvas").getContext("2d");
    var chartData = {
        labels: ["January", "February", "March", "April", "May", "June"],
        datasets: [
            {
                fillColor: [ '#F59A9A', '#4876D0', '#77DCC1', '#85B1F5', '#FDC572', '#F9892E'],
                strokeColor: [ '#F59A9A', '#4876D0', '#77DCC1', '#85B1F5', '#FDC572', '#F9892E'],
                backgroundColor: [
                    '#F59A9A', '#4876D0', '#77DCC1', '#85B1F5', '#FDC572', '#F9892E'
                ],
                // borderWidth:[25, 25,
                //     25, 25 ,25, 25],
                // data: [
                //     100,90,80,80,90, 50, 0,
                //     // randomScalingFactor(),
                //     // randomScalingFactor(),
                // ],
                data: [60, 80, 81, 56, 55, 40]
            }
        ]
    };

    var opt = {
        events: false,
        tooltips: {
            enabled: false
        },
        hover: {
            animationDuration: 0
        },
        legend: {
            display: false,
        },
        animation: {
            duration: 1,
            onComplete: function () {
                console.log(0);
                var chartInstance = this.chart,
                    ctx = chartInstance.ctx;
                ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                // ctx.textAlign = 'right';
                // ctx.textBaseline = 'top';
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                ctx.fillStyle = 'red';
                ctx.border = '1px solid red';
                ctx.lineWidth = 2;
                this.data.datasets.forEach(function (dataset, i) {
                    var meta = chartInstance.controller.getDatasetMeta(i);
                    meta.data.forEach(function (bar, index) {
                        var data = dataset.data[index];
                        ctx.fillText(data, bar._model.x, bar._model.y - 5);
                    });
                });
            }
        }
    };
    // var ctx = document.getElementById("Chart1"),
        myLineChart = new Chart(ctx, {
            type: 'roundedBar',
            data: chartData,
            options: opt
        });
</script>

</body>
</html>
